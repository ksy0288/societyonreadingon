<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">

    <title>êµìœ¡ê³¼ì • ì§€ì‹ ê·¸ë˜í”„ (Curriculum Knowledge Graph)</title>
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <!-- Vis.js -->
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <link href="style.css" rel="stylesheet">
    <style>
        /* Modern Glassmorphism Styles for Mapping Graph */

        body {
            /* Inherit background from style.css */
            overflow: hidden;
            width: 100%;
            height: 100dvh;
            /* Mobile friendly height */
        }

        /* Container */
        #mynetwork {
            width: 100%;
            height: 100%;
            border: none;
            cursor: grab;
            outline: none;
        }

        #mynetwork:active {
            cursor: grabbing;
        }

        /* Overlays (Glassmorphism) */
        .overlay {
            position: absolute;
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            color: var(--secondary-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 10;
        }

        /* Header */
        header.overlay {
            top: 20px;
            left: 80px;
            max-width: 400px;
        }

        h1 {
            font-size: 1.6rem;
            margin: 0;
            color: #2D3748;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        p.subtitle {
            margin: 8px 0 0 0;
            font-size: 0.95rem;
            color: #4A5568;
            font-weight: 400;
        }

        /* Legend */
        .legend {
            bottom: 30px;
            left: 30px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.9rem;
            font-weight: 500;
            color: #4A5568;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Details Panel */
        .details-panel {
            top: 20px;
            right: 20px;
            width: 340px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            transform: translateX(120%);
            z-index: 20;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.85);
            /* Slightly more opaque */
        }

        .details-panel.active {
            transform: translateX(0);
        }

        .details-panel h2 {
            font-size: 1.4rem;
            color: #2D3748;
            border-bottom: 2px solid rgba(0, 0, 0, 0.05);
            padding-bottom: 12px;
            margin: 0 0 20px 0;
            letter-spacing: -0.5px;
        }

        .detail-row {
            margin-bottom: 16px;
            background: rgba(255, 255, 255, 0.6);
            padding: 16px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        .detail-label {
            font-size: 0.85rem;
            color: #718096;
            margin-bottom: 6px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-content {
            font-size: 1rem;
            line-height: 1.6;
            color: #2D3748;
        }

        .close-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(0, 0, 0, 0.05);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            color: #4A5568;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: rgba(0, 0, 0, 0.1);
            color: #000;
        }

        /* Loading */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2rem;
            color: #718096;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.9);
            padding: 16px 32px;
            border-radius: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: opacity 0.5s;
        }

        /* Chatbot UI - Modern Floating */
        .chat-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 64px;
            height: 64px;
            background: #FF7043;
            /* Primary Color */
            border-radius: 50%;
            border: none;
            box-shadow: 0 8px 20px rgba(255, 112, 67, 0.4);
            color: white;
            font-size: 28px;
            cursor: pointer;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .chat-btn:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 12px 24px rgba(255, 112, 67, 0.5);
        }

        .chat-container {
            position: fixed;
            bottom: 110px;
            right: 30px;
            width: 380px;
            height: 500px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            border-radius: 24px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            z-index: 99;
            display: none;
            flex-direction: column;
            overflow: hidden;
            transform-origin: bottom right;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .chat-header {
            background: linear-gradient(135deg, #FF7043, #FFAB91);
            padding: 20px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-body {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #F8F9FA;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .chat-message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 0.95rem;
            line-height: 1.5;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
            font-family: 'Noto Sans KR', sans-serif;
        }

        .bot-msg {
            background: white;
            color: #2D3748;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
            border: 1px solid #E2E8F0;
        }

        .user-msg {
            background: #FF7043;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .chat-input-area {
            padding: 16px;
            background: white;
            border-top: 1px solid #E2E8F0;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            background: #F7FAFC;
            border: 1px solid #E2E8F0;
            border-radius: 24px;
            outline: none;
            font-family: inherit;
            transition: all 0.2s;
        }

        .chat-input:focus {
            background: white;
            border-color: #FF7043;
            box-shadow: 0 0 0 3px rgba(255, 112, 67, 0.1);
        }

        .chat-send {
            width: 44px;
            height: 44px;
            background: #FF7043;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 1.2rem;
        }

        .chat-send:hover {
            background: #F4511E;
            transform: scale(1.05);
        }

        /* Responsive */
        @media (max-width: 768px) {
            header.overlay {
                left: 75px;
                right: 20px;
                padding: 16px;
                background: rgba(255, 255, 255, 0.9);
            }

            h1 {
                font-size: 1.2rem;
            }

            p.subtitle {
                display: none;
            }

            .legend {
                padding: 15px;
                bottom: 20px;
                left: 20px;
                background: rgba(255, 255, 255, 0.9);
            }

            .legend-item {
                font-size: 0.8rem;
            }

            .details-panel {
                width: calc(100% - 40px);
                left: 20px;
                right: 20px;
                top: 90px;
                max-height: 60vh;
            }

            .chat-container {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
                bottom: 100px;
                height: 60vh;
            }
        }
    </style>
</head>

<body>

    <a href="index.html" class="home-btn" title="ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°">ğŸ </a>
    <div class="background"></div>
    <div id="loading" class="loading">Loading Graph...</div>

    <header class="overlay">
        <h1><span class="emoji">ğŸ—ºï¸</span> êµìœ¡ê³¼ì • ë§µí•‘ ê·¸ë˜í”„</h1>
        <p class="subtitle">ì‚¬íšŒê³¼ ì„±ì·¨ê¸°ì¤€-ë‹¨ì›-ë‚´ìš© êµ¬ì¡°í™”</p>
    </header>

    <div class="overlay legend">
        <div class="legend-item">
            <div class="dot" style="background: #3B82F6;"></div><span class="emoji">ğŸ¯</span> ì„±ì·¨ê¸°ì¤€
        </div>
        <div class="legend-item">
            <div class="dot" style="background: #0EA5E9;"></div><span class="emoji">ğŸ“‚</span> ì†Œë‹¨ì›
        </div>
        <div class="legend-item">
            <div class="dot" style="background: #10B981;"></div><span class="emoji">ğŸ“</span> í•™ìŠµ ë‚´ìš©
        </div>
        <div class="legend-item">
            <div class="dot" style="background: #F59E0B;"></div><span class="emoji">ğŸƒ</span> í•™ìŠµ í™œë™
        </div>
        <div class="legend-item">
            <div class="dot" style="background: #64748B;"></div><span class="emoji">ğŸ§©</span> ë‚´ìš© ìš”ì†Œ
        </div>
    </div>

    <div id="detailsPanel" class="overlay details-panel">
        <button class="close-btn" onclick="closeDetails()">&times;</button>
        <h2 id="detailTitle">Node Title</h2>
        <div id="detailBody"></div>
    </div>

    <div id="mynetwork"></div>

    <script type="text/javascript">
        // 1. Data Definition (Parsed from mapping.ttl)
        const dataEntities = {
            // Achievement Standards
            "Std_6sa03-01": { id: "Std_6sa03-01", type: "Standard", label: "[6ì‚¬03-01]", fullText: "ì¼ìƒ ì‚¬ë¡€ì—ì„œ ë²•ì˜ ì˜ë¯¸ì™€ ì—­í• ì„ ì´í•´í•˜ê³ , í—Œë²•ì— ê·œì •ëœ ì¸ê¶Œì´ ì¼ìƒìƒí™œì—ì„œ êµ¬í˜„ë˜ëŠ” ì‚¬ë¡€ë¥¼ ì¡°ì‚¬í•˜ì—¬ ì¸ê¶Œ ì¹œí™”ì  íƒœë„ë¥¼ ê¸°ë¥¸ë‹¤.", source: "cite: 7" },
            "Std_6sa03-02": { id: "Std_6sa03-02", type: "Standard", label: "[6ì‚¬03-02]", fullText: "ì¼ìƒìƒí™œì—ì„œ ì¸ê¶Œì´ ì¹¨í•´ë˜ëŠ” ì‚¬ë¡€ë¥¼ ì°¾ì•„ ê·¸ í•´ê²° ë°©ì•ˆì„ íƒìƒ‰í•˜ê³ , ì¸ê¶Œì„ ë³´í˜¸í•˜ëŠ” í™œë™ì— ì°¸ì—¬í•œë‹¤.", source: "cite: 8" },

            // Content Elements (Connecting Nodes)
            "Elem_HR_Meaning": { id: "Elem_HR_Meaning", type: "Element", label: "ì¸ê¶Œì˜ ì˜ë¯¸", cat: "ì§€ì‹" },
            "Elem_Const_HR": { id: "Elem_Const_HR", type: "Element", label: "í—Œë²•ìƒ ì¸ê¶Œì˜ ë‚´ìš©", cat: "ì§€ì‹" },
            "Elem_Law_Meaning": { id: "Elem_Law_Meaning", type: "Element", label: "ë²•ì˜ ì˜ë¯¸ì™€ ì—­í• ", cat: "ì§€ì‹" },
            "Elem_Law_Case": { id: "Elem_Law_Case", type: "Element", label: "ë²•ì˜ ì ìš© ì‚¬ë¡€", cat: "ì§€ì‹" },
            "Elem_Org_Separation": { id: "Elem_Org_Separation", type: "Element", label: "ê¶Œë ¥ ë¶„ë¦½", cat: "ì§€ì‹" },
            "Elem_Info_Analysis": { id: "Elem_Info_Analysis", type: "Element", label: "ì •ë³´ ìˆ˜ì§‘ ë¶„ì„", cat: "ê¸°ëŠ¥" },
            "Elem_HR_Resolution": { id: "Elem_HR_Resolution", type: "Element", label: "ì¸ê¶Œ ë¬¸ì œ í•´ê²°", cat: "ê¸°ëŠ¥" },
            "Elem_Power_Inquiry": { id: "Elem_Power_Inquiry", type: "Element", label: "ê¶Œë ¥ ë¶„ë¦½ íƒêµ¬", cat: "ê¸°ëŠ¥" },
            "Elem_Compliance": { id: "Elem_Compliance", type: "Element", label: "ì¤€ë²• íƒœë„", cat: "ê°€ì¹˜" },
            "Elem_Right_Responsibility": { id: "Elem_Right_Responsibility", type: "Element", label: "ê¶Œë¦¬ì™€ ì±…ì„", cat: "ê°€ì¹˜" },
            "Elem_HR_Friendly": { id: "Elem_HR_Friendly", type: "Element", label: "ì¸ê¶Œ ì¹œí™”ì  íƒœë„", cat: "ê°€ì¹˜" },
            "Elem_Critical_Attitude": { id: "Elem_Critical_Attitude", type: "Element", label: "ë¹„íŒì  íƒœë„", cat: "ê°€ì¹˜" },

            // Sub Units & Contents
            "SubUnit1": { id: "SubUnit1", type: "SubUnit", label: "1. ì¸ê¶Œì„ ì¡´ì¤‘í•˜ëŠ” ì‚¶", std: "Std_6sa03-02" },
            "SubUnit2": { id: "SubUnit2", type: "SubUnit", label: "2. ì¸ê¶Œ ë³´ì¥ê³¼ í—Œë²•", std: "Std_6sa03-01" },
            "SubUnit3": { id: "SubUnit3", type: "SubUnit", label: "3. ë²•ì˜ ì˜ë¯¸ì™€ ì—­í• ", std: "Std_6sa03-01" },
        };

        const contents = [
            // SubUnit 1
            { id: "Content1_1", subUnit: "SubUnit1", topic: "ì¸ê¶Œì˜ ì˜ë¯¸ì™€ ì¼ìƒìƒí™œ ì† ì¸ê¶Œ", activity: "ì¸ê¶Œ í•˜ë©´ ë– ì˜¤ë¥´ëŠ” ê²ƒ ì¨ë³´ê¸°, ëˆ„ë¦¬ê³  ìˆëŠ” ì¸ê¶Œ ì¨ë³´ê¸°", links: ["Elem_HR_Meaning", "Elem_HR_Friendly"] },
            { id: "Content1_2", subUnit: "SubUnit1", topic: "ì¸ê¶Œ ì‹ ì¥ì„ ìœ„í•´ ë…¸ë ¥í–ˆë˜ ì˜› ì‚¬ëŒë“¤", activity: "í™ê¸¸ë™ì „ ì¸ê¶Œ ë¬¸ì œ ì“°ê¸°, ì—­ì‚¬ ì‹ ë¬¸ ë§Œë“¤ê¸°", links: ["Elem_HR_Meaning", "Elem_Info_Analysis"] },
            { id: "Content1_3", subUnit: "SubUnit1", topic: "ìƒí™œ ì† ì¸ê¶Œ ë³´ì¥ ì‚¬ë¡€ ë° ì‹¤ì²œ íƒœë„", activity: "ì¸ê¶Œ ì¹¨í•´ ì‚¬ë¡€ ì°¾ê¸°, 'ì—ë² ë ˆìŠ¤íŠ¸ì‚° ê³„ë‹¨' ê´‘ê³  ë¶„ì„", links: ["Elem_HR_Resolution", "Elem_HR_Friendly"] },
            { id: "Content1_4", subUnit: "SubUnit1", topic: "í†µí•© í•™ìŠµ í™œë™ (ì¸ê¶Œ)", activity: "ìš°ë¦¬ ë°˜ ì¸ê¶Œ ì„ ì–¸ ë° ì¹´ë“œ ë§Œë“¤ê¸°", links: ["Elem_HR_Friendly", "Elem_HR_Resolution"] },

            // SubUnit 2
            { id: "Content2_1", subUnit: "SubUnit2", topic: "í—Œë²•ì˜ ì˜ë¯¸ì™€ ì¸ê¶Œ", activity: "í—Œë²• ì† ì¸ê¶Œ ë‚´ìš© ì°¾ê¸°, ê·¸ë¦¼ ê·¸ë¦¬ê¸°", links: ["Elem_Const_HR"] },
            { id: "Content2_2", subUnit: "SubUnit2", topic: "ì¸ê¶Œ ë³´ì¥ì„ ìœ„í•œ í—Œë²•ì˜ ì—­í• ", activity: "í•™ì› ì‹¬ì•¼ êµìŠµ ì œí•œ ì˜ê²¬ ì“°ê¸°", links: ["Elem_Const_HR", "Elem_Info_Analysis"] },
            { id: "Content2_3", subUnit: "SubUnit2", topic: "êµ­ë¯¼ì˜ ê¸°ë³¸ê¶Œ (í‰ë“±/ììœ  ë“±)", activity: "ê¸°ë³¸ê¶Œ ì ìš© ì‚¬ë¡€ ì°¾ê¸°", links: ["Elem_Const_HR", "Elem_Info_Analysis"] },
            { id: "Content2_4", subUnit: "SubUnit2", topic: "êµ­ë¯¼ì˜ ì˜ë¬´", activity: "ìš°ë¦¬ ê°€ì¡±ì˜ ìƒí™œ ëª¨ìŠµì—ì„œ ì˜ë¬´ ì°¾ê¸°", links: ["Elem_Right_Responsibility"] },
            { id: "Content2_5", subUnit: "SubUnit2", topic: "ê¶Œë¦¬ì™€ ì˜ë¬´ì˜ ê´€ê³„", activity: "ê°ˆë“± ì‚¬ë¡€ ê¸°ì‚¬ ì½ê³  ìƒê° ì“°ê¸°", links: ["Elem_Right_Responsibility", "Elem_HR_Friendly"] },

            // SubUnit 3
            { id: "Content3_1", subUnit: "SubUnit3", topic: "ë²•ì˜ ì •ì˜", activity: "ë²• ê´€ë ¨ ìƒí™© ì°¾ê¸°", links: ["Elem_Law_Meaning"] },
            { id: "Content3_2", subUnit: "SubUnit3", topic: "ìƒí™œ ì† ë²• ì ìš© ì‚¬ë¡€", activity: "ì‚¬ë¡€ì™€ ë²• ì—°ê²°í•˜ê¸°", links: ["Elem_Law_Case", "Elem_Info_Analysis"] },
            { id: "Content3_3", subUnit: "SubUnit3", topic: "ë²•ì˜ ì—­í• ", activity: "ê¶Œë¦¬ ì¹¨í•´/ì‚¬íšŒ ì§ˆì„œ ë¬¸ì œ ì—­í• ë†€ì´", links: ["Elem_Law_Meaning", "Elem_HR_Resolution"] },
            { id: "Content3_4", subUnit: "SubUnit3", topic: "ë²•ì„ ì¤€ìˆ˜í•˜ëŠ” íƒœë„", activity: "ì¤€ë²• í–‰ë™ ì“°ê¸°, ìº í˜ì¸ í™œë™", links: ["Elem_Compliance"] },
            { id: "Content3_5", subUnit: "SubUnit3", topic: "í†µí•© í•™ìŠµ í™œë™ (ë²•)", activity: "ì •ì˜ì˜ ì‹  í‘œí˜„í•˜ê¸°, ë²• ì œì•ˆí•˜ê¸°", links: ["Elem_Compliance", "Elem_Law_Meaning"] }
        ];

        // 2. Build Graph Data
        const nodes = [];
        const edges = [];
        const addedNodes = new Set();

        function addNode(id, group, label, meta = {}) {
            if (!addedNodes.has(id)) {
                nodes.push({ id, group, label, ...meta });
                addedNodes.add(id);
            }
        }

        // Add Standard Nodes (Center)
        Object.values(dataEntities).forEach(e => {
            if (e.type === "Standard") {
                addNode(e.id, "standard", e.label, {
                    title: e.fullText,
                    value: 40,
                    font: { size: 18, color: '#1E3A8A', face: 'Noto Sans KR', strokeWidth: 4, strokeColor: '#ffffff' },
                    color: { background: '#3B82F6', border: '#2563EB' }
                });
            } else if (e.type === "SubUnit") {
                addNode(e.id, "subunit", e.label, {
                    value: 25,
                    font: { size: 14, color: '#0369A1', face: 'Noto Sans KR', strokeWidth: 3, strokeColor: '#ffffff' },
                    color: { background: '#0EA5E9', border: '#0284C7' }
                });
                // Connect SubUnit to Standard
                edges.push({ from: e.std, to: e.id, length: 150, width: 2, color: { opacity: 0.8, color: '#B0BEC5' } });
            } else if (e.type === "Element") {
                addNode(e.id, "element", e.label, {
                    value: 15,
                    title: e.cat,
                    shape: "dot",
                    color: "#94A3B8",
                    font: { size: 12, color: '#475569', face: 'Noto Sans KR', strokeWidth: 2, strokeColor: '#ffffff' }
                });
            }
        });

        // Add Content & Activity Nodes
        contents.forEach(content => {
            // Content Node
            addNode(content.id, "content", content.topic, {
                value: 20,
                font: { size: 13, color: '#064E3B', face: 'Noto Sans KR', strokeWidth: 3, strokeColor: '#ffffff' },
                color: { background: '#10B981', border: '#059669' }
            });
            // Connect Content to SubUnit
            edges.push({ from: content.subUnit, to: content.id, length: 100, color: { opacity: 0.6 } });

            // Activity Node (Child of Content)
            const actId = content.id + "_act";
            addNode(actId, "activity", "í™œë™", {
                title: content.activity,
                label: "í™œë™",
                font: { size: 11, color: '#92400E', face: 'Noto Sans KR', strokeWidth: 2, strokeColor: '#ffffff' },
                color: { background: '#F59E0B', border: '#D97706' }
            });
            edges.push({ from: content.id, to: actId, length: 50, color: { opacity: 0.3, style: 'dash' } });

            // Link Content to Elements
            if (content.links) {
                content.links.forEach(linkId => {
                    // Ensure element exists (it should)
                    if (dataEntities[linkId]) {
                        edges.push({ from: content.id, to: linkId, length: 150, dashes: true, color: { opacity: 0.2, color: '#ffffff' } });
                    }
                });
            }
        });

        // 3. Visualization Setup
        const container = document.getElementById('mynetwork');
        const data = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };
        const options = {
            nodes: {
                shape: 'dot',
                borderWidth: 0,
                shadow: true,
                font: {
                    strokeWidth: 3,
                    strokeColor: '#ffffff'
                }
            },
            groups: {
                standard: { color: { background: '#3B82F6', border: '#2563EB' } },
                subunit: { color: { background: '#0EA5E9', border: '#0284C7' } },
                content: { color: { background: '#10B981', border: '#059669' } },
                activity: { color: { background: '#F59E0B', border: '#D97706' } },
                element: { color: { background: '#64748B', border: '#475569' } }
            },
            edges: {
                width: 1,
                smooth: {
                    type: 'continuous'
                }
            },
            physics: {
                forceAtlas2Based: {
                    gravitationalConstant: -100,
                    centralGravity: 0.005,
                    springLength: 150,
                    springConstant: 0.18
                },
                maxVelocity: 50,
                solver: 'forceAtlas2Based',
                timestep: 0.35,
                stabilization: {
                    enabled: true,
                    iterations: 1000,
                    updateInterval: 25
                }
            },
            interaction: {
                hover: true,
                tooltipDelay: 200,
                zoomView: true
            }
        };

        const network = new vis.Network(container, data, options);

        // 4. Interaction Logic
        network.on("stabilizationIterationsDone", function () {
            document.getElementById('loading').style.opacity = 0;
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
            }, 500);
        });

        network.on("click", function (params) {
            if (params.nodes.length > 0) {
                const nodeId = params.nodes[0];
                const node = nodes.find(n => n.id === nodeId);
                if (node) {
                    showDetails(node);
                }
            } else {
                closeDetails();
            }
        });

        function showDetails(node) {
            const panel = document.getElementById('detailsPanel');
            const title = document.getElementById('detailTitle');
            const body = document.getElementById('detailBody');

            // Find full data object if possible
            let contentHtml = "";

            if (node.group === "standard") {
                const entity = dataEntities[node.id];
                title.innerText = entity.label;
                title.style.color = "#1E3A8A"; // Blue 900
                contentHtml = `
                    <div class="detail-row">
                        <div class="detail-label"><span class="emoji">ğŸ“„</span> ë‚´ìš© (Description)</div>
                        <div class="detail-content">${entity.fullText}</div>
                    </div>
                `;
            } else if (node.group === "subunit") {
                const entity = dataEntities[node.id];
                title.innerText = entity.label;
                title.style.color = "#0369A1"; // Sky 800
                contentHtml = `
                    <div class="detail-row">
                        <div class="detail-label"><span class="emoji">â¬†ï¸</span> ìƒìœ„ ì„±ì·¨ê¸°ì¤€</div>
                        <div class="detail-content">${dataEntities[entity.std].label}</div>
                    </div>
                `;
            } else if (node.group === "content") {
                const contentData = contents.find(c => c.id === node.id);
                title.innerText = "í•™ìŠµ ë‚´ìš©";
                title.style.color = "#064E3B"; // Emerald 900
                contentHtml = `
                    <div class="detail-row">
                        <div class="detail-label"><span class="emoji">ğŸ“Œ</span> ì£¼ì œ (Topic)</div>
                        <div class="detail-content">${contentData.topic}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label"><span class="emoji">ğŸ”—</span> ê´€ë ¨ í™œë™</div>
                        <div class="detail-content">${contentData.activity}</div>
                    </div>
                `;
            } else if (node.group === "activity") {
                const parentId = edges.find(e => e.to === node.id).from;
                const contentData = contents.find(c => c.id === parentId);
                title.innerText = "í•™ìŠµ í™œë™";
                title.style.color = "#92400E"; // Amber 800
                contentHtml = `
                    <div class="detail-row">
                        <div class="detail-label"><span class="emoji">ğŸƒ</span> í™œë™ ë‚´ìš©</div>
                        <div class="detail-content">${contentData.activity}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label"><span class="emoji">ğŸ“Œ</span> ê´€ë ¨ ì£¼ì œ</div>
                        <div class="detail-content">${contentData.topic}</div>
                    </div>
                `;
            } else if (node.group === "element") {
                const entity = dataEntities[node.id];
                title.innerText = entity.label;
                title.style.color = "#475569"; // Slate 600
                contentHtml = `
                    <div class="detail-row">
                        <div class="detail-label"><span class="emoji">ğŸ·ï¸</span> ì¹´í…Œê³ ë¦¬</div>
                        <div class="detail-content">${entity.cat}</div>
                    </div>
                 `;
            }

            body.innerHTML = contentHtml;
            panel.classList.add('active');
        }

        function closeDetails() {
            document.getElementById('detailsPanel').classList.remove('active');
        }
    </script>

    <!-- Chatbot UI -->
    <button class="chat-btn" onclick="toggleChat()" id="chatButton">ğŸ’¬</button>
    <div class="chat-container" id="chatContainer">
        <div class="chat-header">
            <span>ğŸ“ êµìœ¡ê³¼ì • ë„ìš°ë¯¸</span>
            <button onclick="toggleChat()"
                style="background:none; border:none; color:white; font-size:1.2rem; cursor:pointer;">&times;</button>
        </div>
        <div class="chat-body" id="chatBody">
            <div class="chat-message bot-msg">ì•ˆë…•! ë‚˜ëŠ” ì‚¬íšŒê³¼ êµìœ¡ê³¼ì • ë„ìš°ë¯¸ì•¼. ê¶ê¸ˆí•œ ê²Œ ìˆìœ¼ë©´ ë¬¼ì–´ë´! ğŸ˜Š<br>ì˜ˆ: "ì¸ê¶Œì´ ë­ì•¼?", "í•™ìŠµ í™œë™ ì¶”ì²œí•´ì¤˜"
            </div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chatInput" class="chat-input" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..."
                onkeypress="if(event.key==='Enter') sendMessage()">
            <button class="chat-send" onclick="sendMessage()">ì „ì†¡</button>
        </div>
    </div>

    <script>
        // Chatbot Logic
        const chatBody = document.getElementById('chatBody');
        const chatInput = document.getElementById('chatInput');

        function toggleChat() {
            const container = document.getElementById('chatContainer');
            const btn = document.getElementById('chatButton');
            if (container.style.display === 'flex') {
                container.style.display = 'none';
                btn.style.display = 'flex';
            } else {
                container.style.display = 'flex';
                btn.style.display = 'none';
                setTimeout(() => chatInput.focus(), 100);
            }
        }

        function addMessage(text, isUser) {
            const msgDiv = document.createElement('div');
            msgDiv.className = `chat-message ${isUser ? 'user-msg' : 'bot-msg'}`;
            msgDiv.innerHTML = text;
            chatBody.appendChild(msgDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        function sendMessage() {
            const text = chatInput.value.trim();
            if (!text) return;

            addMessage(text, true);
            chatInput.value = '';

            // Simulate AI response
            setTimeout(() => {
                const response = getBotResponse(text);
                addMessage(response, false);
            }, 500);
        }

        function getBotResponse(query) {
            query = query.toLowerCase();

            // 1. Check selected node context
            const selectedNodes = network.getSelectedNodes();
            let contextNode = null;
            if (selectedNodes.length > 0) {
                // Find node data
                contextNode = nodes.find(n => n.id === selectedNodes[0]);
            }

            // 2. Keyword matching
            if (query.includes("ì•ˆë…•")) return "ë°˜ê°€ì›Œ! ì‚¬íšŒ ê³µë¶€ ì¬ë¯¸ìˆê²Œ í•´ë³´ì! ğŸ«";
            if (query.includes("ë„ì™€ì¤˜")) return "êµìœ¡ê³¼ì • ë‚´ìš©ì´ë‚˜ ìˆ˜ì—… í™œë™ì— ëŒ€í•´ ë¬¼ì–´ë³´ë©´ ì„¤ëª…í•´ ì¤„ê²Œ.";

            // Specific Logic
            if (query.includes("ì¸ê¶Œ") || query.includes("ê¶Œë¦¬")) {
                return "ì¸ê¶Œì€ ì‚¬ëŒì´ ì‚¬ëŒë‹µê²Œ ì‚´ ê¶Œë¦¬ì•¼. ìš°ë¦¬ ìˆ˜ì—…ì—ì„œëŠ” <strong>[6ì‚¬03-01], [6ì‚¬03-02]</strong> ì„±ì·¨ê¸°ì¤€ì—ì„œ ë‹¤ë£¨ê³  ìˆì–´. 'ì¸ê¶Œì˜ ì˜ë¯¸', 'í—Œë²•', 'ì¸ê¶Œ ë³´í˜¸ í™œë™' ë“±ì„ ë°°ì›Œ!";
            }
            if (query.includes("ë²•") || query.includes("ì¤€ë²•")) {
                return "ë²•ì€ ì‚¬ëŒë“¤ì´ í•¨ê»˜ ì‚´ì•„ê°€ê¸° ìœ„í•œ ì•½ì†ì´ì•¼. <strong>'ë²•ì˜ ì˜ë¯¸ì™€ ì—­í• '</strong>ì„ ë°°ìš°ê³ , ì‹¤ìƒí™œì—ì„œ ë²•ì„ ì§€í‚¤ëŠ” íƒœë„ë¥¼ ê¸°ë¥´ëŠ” ê²Œ ì¤‘ìš”í•´.";
            }
            if (query.includes("í™œë™") || query.includes("ìˆ˜ì—…")) {
                if (contextNode && contextNode.group === 'content') {
                    // Try to find activity linked to this content
                    // This requires searching edges, but let's just generic response for now
                    return `'${contextNode.label}' ì£¼ì œë¡œëŠ” ì—­í• ë†€ì´ë‚˜ ìº í˜ì¸ í™œë™ì„ ì¶”ì²œí•´! ì¹œêµ¬ë“¤ê³¼ í† ë¡ í•´ë³´ëŠ” ê²ƒë„ ì¢‹ì•„.`;
                }
                return "í•™ìƒë“¤ì´ ì§ì ‘ ì°¸ì—¬í•˜ëŠ” í™œë™ì´ ì¢‹ì•„. <br>1. ì¸ê¶Œ ì„ ì–¸ë¬¸ ë§Œë“¤ê¸° ğŸ“œ<br>2. ë²• ë§Œë“¤ê¸° ëª¨ì˜êµ­íšŒ âš–ï¸<br>3. ì¸ê¶Œ ì¹¨í•´ ì‚¬ë¡€ ì¡°ì‚¬í•˜ê¸° ğŸ”<br>ì´ëŸ° í™œë™ë“¤ì€ ì–´ë•Œ?";
            }
            if (query.includes("ì—°ê²°") || query.includes("ê´€ê³„")) {
                return "ì´ ê·¸ë˜í”„ë¥¼ ë³´ë©´ ì•Œ ìˆ˜ ìˆë“¯ì´, <strong>ì„±ì·¨ê¸°ì¤€</strong>ì€ <strong>ì†Œë‹¨ì›</strong>ê³¼ ì—°ê²°ë˜ê³ , ì†Œë‹¨ì›ì€ êµ¬ì²´ì ì¸ <strong>í•™ìŠµ ë‚´ìš©</strong>ê³¼ ì—°ê²°ë¼. ëª¨ë“  ê±´ ìœ ê¸°ì ìœ¼ë¡œ ì´ì–´ì ¸ ìˆì–´!";
            }

            // Context specific response
            if (contextNode) {
                if (query.includes("ì´ê±´ ë­ì•¼") || query.includes("ì„¤ëª…")) {
                    if (contextNode.title) return `<strong>${contextNode.label}</strong>ì— ëŒ€í•œ ì„¤ëª…ì´ì•¼:<br>${contextNode.title}`;
                    return `<strong>${contextNode.label}</strong>ì€ êµìœ¡ê³¼ì •ì˜ ì¤‘ìš”í•œ ìš”ì†Œì•¼.`;
                }
            }

            return "ìŒ, ê·¸ê±´ ì¡°ê¸ˆ ì–´ë ¤ìš´ ì§ˆë¬¸ì´ë„¤. 'ì¸ê¶Œ', 'ë²•', 'í™œë™', 'ì—°ê²°' ê°™ì€ ë‹¨ì–´ë¡œ ë‹¤ì‹œ ë¬¼ì–´ë´ ì¤„ë˜? ì•„ë‹ˆë©´ ê·¸ë˜í”„ì—ì„œ ë…¸ë“œë¥¼ í´ë¦­í•˜ê³  ë¬¼ì–´ë´!";
        }
    </script>

</body>

</html>